name: Login Helper

on:
  workflow_dispatch:

jobs:
  interactive-login:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Dependencies
        run: |
          npm install --ignore-scripts
          npx playwright install chromium

      - name: Start Web Terminal (Cloudflare)
        run: |
          # Install ttyd (Terminal)
          wget -q -O ttyd https://github.com/tsl0922/ttyd/releases/download/1.7.7/ttyd.x86_64
          chmod +x ttyd
          # Start ttyd in background (Writable mode)
          ./ttyd -W -p 8080 bash &
          
          # Install Cloudflared (Tunnel)
          wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
          sudo dpkg -i cloudflared-linux-amd64.deb
          
          # Start Tunnel
          cloudflared tunnel --url http://localhost:8080 > tunnel.log 2>&1 &
          
          echo "Waiting for Cloudflare connection..."
          sleep 10
          
          echo "--------------------------------------------------"
          echo "ðŸ‘‡ CLICK THIS LINK TO OPEN TERMINAL ðŸ‘‡"
          grep -o 'https://.*\.trycloudflare.com' tunnel.log
          echo "ðŸ‘† CLICK THIS LINK TO OPEN TERMINAL ðŸ‘†"
          echo "--------------------------------------------------"
          
          # Keep alive for 1 hour
          sleep 3600
